var activeLayer = 2;
var totalLayers = 4;

function StartMapManager()
{
    imgLib.addImage("ground", "img/ground.png");
    imgLib.addImage("bamboo", "img/bamboo.png");
    imgLib.addImage("bamboo2", "img/bamboo2.png");
    imgLib.addImage("wall", "img/wall.png");
    imgLib.addImage("wall2", "img/wall2.png");
    imgLib.addImage("wall3", "img/wall3.png");
    
    var mapCoord1 = [
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
                   ];
    var layer1 = new Map(0, 0, mapCoord1, 25, "blue");
    layers[0] = layer1;
    
    var mapCoord2 = [
                   [3, 3, 3, 0, 3, 3, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 3, 3, 0, 3, 0, 0, 0, 0, 0, 0, 0, 3],
                   [3, 3, 3, 0, 3, 3, 0, 0, 0, 0, 4, 0, 3, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 3, 3, 3, 0, 3, 0, 0, 0, 0, 0, 0, 0, 3],
                   [3, 3, 3, 0, 3, 3, 0, 0, 0, 0, 3, 0, 3, 3, 0, 0, 0, 4, 0, 0, 0, 0, 0, 3, 0, 0, 0, 3, 3, 3, 0, 3, 0, 0, 0, 0, 0, 0, 0, 3],
                   [3, 3, 3, 0, 3, 3, 0, 4, 0, 0, 3, 0, 3, 3, 4, 0, 4, 3, 0, 0, 0, 0, 0, 3, 0, 0, 0, 3, 3, 3, 0, 3, 0, 0, 0, 0, 0, 0, 0, 3],
                   [3, 3, 3, 0, 3, 3, 4, 3, 0, 0, 3, 0, 3, 3, 3, 0, 3, 3, 0, 0, 0, 0, 0, 3, 0, 0, 0, 3, 3, 3, 0, 3, 0, 0, 0, 4, 0, 0, 0, 3],
                   [3, 3, 3, 0, 3, 3, 3, 3, 0, 0, 3, 0, 3, 3, 3, 0, 3, 3, 0, 0, 0, 0, 0, 3, 0, 0, 0, 3, 3, 3, 0, 3, 0, 0, 0, 3, 0, 0, 4, 3],
                   [3, 3, 3, 0, 3, 3, 3, 3, 0, 0, 3, 0, 3, 3, 3, 0, 3, 3, 0, 0, 0, 0, 0, 3, 0, 0, 0, 3, 3, 3, 0, 3, 0, 0, 0, 3, 0, 0, 3, 3]
                   ];
    var layer2 = new Map(1, 0, mapCoord2, 70, "green");
    layers[1] = layer2;
    
    var mapCoord3 = [
                   [3,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0],
                   [3,0,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,4,0,0,0,0,0],
                   [3,0,3,3,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,3,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,4,3,3,0,0,0,0,0,0,0,0,0,4,0,0,3,0,0,3,0,0,0,0,0],
                   [3,4,3,3,4,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,4,3,0,0,0,0,0,0,0,0,0,0,0,3,3,3,4,0,0,0,0,0,0,0,0,3,0,0,3,0,0,3,0,0,0,0,0],
                   [3,3,3,3,3,0,0,4,3,5,2,2,2,2,2,2,2,2,2,2,6,0,0,0,0,0,3,3,5,2,2,6,5,2,2,2,2,2,2,6,0,0,0,3,3,5,2,6,0,5,2,2,2,2,2,2,2,2,2,2,6,0,5,2,2,2,6,5,2,2,2,2,2,6,3,0,0,0,0,0],
                   [3,3,3,3,3,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0],
                   [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
                   ];
    var layer3 = new Map(2, 0, mapCoord3, 80, "grey");
    layers[2] = layer3;
    
    var mapCoord4 = [
                   [3, 3, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 3, 3, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 3],
                   [3, 3, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 3, 3, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 3],
                   [3, 3, 4, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 3, 3, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 3],
                   [3, 3, 3, 0, 0, 4, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 3, 3, 0, 0, 0, 0, 0, 3, 0, 0, 0, 4, 0, 3, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 3],
                   [3, 3, 3, 0, 0, 3, 4, 0, 0, 0, 3, 0, 0, 0, 0, 0, 3, 3, 0, 0, 0, 0, 0, 3, 0, 0, 0, 3, 0, 3, 0, 0, 0, 0, 0, 3, 0, 0, 4, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 3],
                   [3, 3, 3, 0, 0, 3, 3, 0, 0, 0, 3, 0, 0, 0, 0, 0, 3, 3, 0, 4, 0, 0, 0, 3, 0, 0, 0, 3, 0, 3, 0, 0, 4, 0, 0, 3, 0, 0, 3, 4, 0, 0, 0, 3, 0, 0, 0, 0, 0, 3],
                   [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
                   ];
    var layer4 = new Map(3, 0, mapCoord4, 110, "green");
    layers[3] = layer4;
}

function UpdateMapManager()
{
    for(var i = 0; i < totalLayers; i++)
    {
        if(player.state != 4)
        {
            layers[i].MoveMap(dt);
        }
    }
    if((layers[activeLayer].relativeX + player.x - screen.width/2) >= (layers[activeLayer].size - 1)*layers[activeLayer].TS || (layers[activeLayer].relativeX + player.x - screen.width/2) < screen.width/2)
    {
        if(staticCamera == false)
        {
            staticCamera = true;
            layers[activeLayer].mapaAx = 0;
            layers[activeLayer].mapaVx = 0;
            for(var i = 0; i < totalLayers; i++)
            {
                layers[i].mapaX = 0;
            }
            player.vx = -player.speedX;
        }
    }
    else
    {
        if(staticCamera == true)
        {
            staticCamera = false;
            player.ax = 0;
            player.vx = 0;
            layers[activeLayer].mapaVx = -player.speedX;
        }
    }
}

function KeydownMapManager(key)
{
    if(!player.damaged)
    {
        switch(key)
        {
            case 65:
                if(!staticCamera && player.state != 4) layers[activeLayer].mapaVx = player.speedX;
            break;
            case 68:
                if(!staticCamera && player.state != 4) layers[activeLayer].mapaVx = -player.speedX;
            break;
            case 38:
            break;
        }
    }
}

function KeyupMapManager(key)
{
    if(!player.damaged)
    {
        switch(key)
        {
            case 65:
                layers[activeLayer].mapaAx = 0;
                layers[activeLayer].mapaVx = 0;
            break;
            case 68:
                layers[activeLayer].mapaAx = 0;
                layers[activeLayer].mapaVx = 0;
            break;
            case 38:
            break;
        }
    }
}